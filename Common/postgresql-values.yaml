architecture: replication
global:
  postgresql:
    auth:
      existingSecret: postgresql
      database: postgres
metrics:
  enabled: true
  pgStatStatements: true

primary:
  extendedConfiguration: |
    max_connections = 3001
    shared_preload_libraries = 'pg_stat_statements'
    pg_stat_statements.track = all
    # Logging settings
    log_destination = 'stderr'
    logging_collector = on
    log_directory = '/bitnami/postgresql/logs'
    # Log rotation settings - keeps only 7 days automatically
    log_filename = 'postgresql-%a.log'  # %a = day name (Mon, Tue, Wed, Thu, Fri, Sat, Sun)
    log_rotation_age = '1d'             # Rotate logs daily at midnight
    log_rotation_size = 0               # Disable size-based rotation (time-based only)
    log_truncate_on_rotation = on       # Overwrite old log when rotating (keeps only 7 days)
    log_file_mode = 0600                # Secure file permissions (read/write for owner only)
    log_connections = off
    log_disconnections = off
    log_min_duration_statement = 1000
    log_statement = 'all'
  persistence:
    size: 2Gi
  resourcesPreset: medium

readReplicas:
  replicaCount: 1
  extendedConfiguration: |
    max_connections = 3001
    shared_preload_libraries = 'pg_stat_statements'
    pg_stat_statements.track = all
    # Logging settings
    log_destination = 'stderr'
    logging_collector = on
    log_directory = '/bitnami/postgresql/logs'
    # Log rotation settings - keeps only 7 days automatically
    log_filename = 'postgresql-%a.log'  # %a = day name (Mon, Tue, Wed, Thu, Fri, Sat, Sun)
    log_rotation_age = '1d'             # Rotate logs daily at midnight
    log_rotation_size = 0               # Disable size-based rotation (time-based only)
    log_truncate_on_rotation = on       # Overwrite old log when rotating (keeps only 7 days)
    log_file_mode = 0600                # Secure file permissions (read/write for owner only)
    log_disconnections = off
    log_min_duration_statement = 1000
    log_statement = 'all'
  persistence:
    size: 2Gi
  resourcesPreset: medium

replication:
  enabled: true
  numSynchronousReplicas: 1
  synchronousCommit: "on"
